<div class="device-container">
  <!-- Messages -->
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="success">{{ successMessage }}</div>

  <!-- Action Bar -->
  <div class="action-bar" *ngIf="!isCreating && !isEditing">
    <div class="filter-controls">
      <div class="filter-group">
        <label>Filter by Status:</label>
        <select [(ngModel)]="filterStatus" class="filter-select">
          <option value="all">All Statuses</option>
          <option *ngFor="let status of getUniqueStatuses()" [value]="status">{{ status }}</option>
        </select>
      </div>
      <div class="search-group">
        <label>Search:</label>
        <input type="text" [(ngModel)]="searchText" placeholder="Search devices..." class="search-input">
      </div>
    </div>
    <button class="btn btn-primary" (click)="showCreateForm()">+ Add New Device</button>
  </div>

  <!-- Create Form -->
  <div *ngIf="isCreating" class="form-card">
    <h2>Create New Customer Device</h2>
    <form (ngSubmit)="createCustomerDevice()">
      <div class="form-row">
        <div class="form-group">
          <label>Customer ID *</label>
          <input type="text" [(ngModel)]="newCustomerDevice.customerId" name="customerId" required 
                 placeholder="Enter customer ID">
        </div>
        <div class="form-group">
          <label>Serial</label>
          <input type="text" [(ngModel)]="newCustomerDevice.serial" name="serial" 
                 placeholder="Enter serial number">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Controller Device</label>
          <select [(ngModel)]="newCustomerDevice.controllerDevice" name="controllerDevice">
            <option value="">Select...</option>
            <option value="Y">Y</option>
            <option value="N">N</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="newCustomerDevice.status" name="status" required>
            <option value="">Select Status...</option>
            <option value="Active">Active</option>
            <option value="Disconnected">Disconnected</option>
          </select>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Create Device</button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Edit Form -->
  <div *ngIf="isEditing && selectedCustomerDevice" class="form-card">
    <h2>Edit Customer Device</h2>
    <form (ngSubmit)="updateCustomerDevice()">
      <div class="form-row">
        <div class="form-group">
          <label>Customer ID *</label>
          <input type="text" [(ngModel)]="selectedCustomerDevice.customerId" name="customerId" required 
                 placeholder="Enter customer ID">
        </div>
        <div class="form-group">
          <label>Serial</label>
          <input type="text" [(ngModel)]="selectedCustomerDevice.serial" name="serial" 
                 placeholder="Enter serial number">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Controller Device</label>
          <select [(ngModel)]="selectedCustomerDevice.controllerDevice" name="controllerDevice">
            <option value="">Select...</option>
            <option value="Y">Y</option>
            <option value="N">N</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="selectedCustomerDevice.status" name="status" required>
            <option value="">Select Status...</option>
            <option value="Active">Active</option>
            <option value="Disconnected">Disconnected</option>
          </select>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Update Device</button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">Loading customer devices...</div>

  <!-- Devices Grid -->
  <div *ngIf="!loading && !isCreating && !isEditing" class="devices-grid">
    <div *ngFor="let device of getFilteredCustomerDevices()" class="card device-card">
      <div class="device-header">
        <div class="device-info">
          <span class="device-id">ID: {{ device.id }}</span>
          <span class="status-badge" [class.status-active]="device.status === 'Active'" 
                [class.status-disconnected]="device.status === 'Disconnected'">
            {{ device.status }}
          </span>
        </div>
      </div>

      <div class="device-body">
        <div class="info-row">
          <span class="label">Customer ID:</span>
          <span class="value">{{ device.customerId }}</span>
        </div>
        <div class="info-row" *ngIf="device.serial">
          <span class="label">Serial:</span>
          <span class="value">{{ device.serial }}</span>
        </div>
        <div class="info-row" *ngIf="device.controllerDevice">
          <span class="label">Controller Device:</span>
          <span class="value">{{ device.controllerDevice }}</span>
        </div>
        <div class="info-row" *ngIf="device.createdAt">
          <span class="label">Created:</span>
          <span class="value">{{ device.createdAt | date:'short' }}</span>
        </div>
      </div>

      <div class="device-footer">
        <button class="btn btn-primary btn-sm" (click)="editCustomerDevice(device)">Edit</button>
        <button class="btn btn-danger btn-sm" (click)="deleteCustomerDevice(device.id)">Delete</button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !isCreating && !isEditing && getFilteredCustomerDevices().length === 0" class="empty-state">
    <p>No customer devices found. Create your first device!</p>
  </div>
</div>
